<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.mx/thymeleaf/layout" layout:decorate="~{layouts/main}">

<head>
    <title>Confirmation</title>
</head>

<body>

    <div layout:fragment="content">
        <div class="container">
            <div class="row mt-5">
                <div class="col-md-6 offset-md-3 text-center mb-5" style="border: 5px solid black;">
                    <h2 class="text-center m-1">Résumé de votre réservation</h2>

                    <div th:if="${representation != null}" class="text-center">

                        <!-- Utilisation d'une expression Thymeleaf pour l'image -->
                        <img th:src="@{'/images/' + ${representation.show.posterUrl}}" alt="Poster du spectacle"
                            class="img-fluid" width="150" />

                        <!-- Calculer le total sans accéder directement à la propriété 'price' -->

                    </div>
                    <div>
                        <strong>En date du :</strong>
                        <span th:text="${#temporals.format(representation.when, 'd MMMM yyyy à HH:mm')}"></span>
                        <p><strong>Titre de la pièce :</strong> <span
                                th:text="${representation.show.title}"></span></p>

                        <div th:if="${username != null}">
                            <p><strong>Êtes-vous</strong> <span th:text="${username}"></span><strong>?</strong></p>

                        </div>
                        <div th:if="${username != null}">
                            <p><strong>Confirmez-vous le total ?</strong></p>
                            <p><strong>Nombre de places :</strong> 
                                <select name="nbPlaces" id="nbPlaces" th:field="*{nbPlaces}">
                                    <option th:each="i : ${#numbers.sequence(1, 10)}" th:value="${i}"
                                        th:text="${i}" th:selected="${i == nbPlaces}">1</option>
                                </select>
                            </p>

                        </div>
                        <p class="text-start">
                            <strong>Total à payer</strong><br> <span
                                th:utext="${#numbers.formatDecimal(representation.show.price * nbPlaces, representation.show.price * nbPlaces >= 10 ? 2 : 1, 'COMMA', 2, 'POINT')}"></span>
                            €
                        </p>

                        <form th:action="@{/checkout}" th:method="POST">
                            <button type="submit" class="btn btn-primary">Continuer vers paiement</button>
                        </form>
                    </div>
                </div>


            </div>
        </div>
    </div>

</body>

</html>
